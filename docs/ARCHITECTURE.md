# CAN Pub/Sub Architecture Diagrams

Visual reference for understanding the CAN pub/sub protocol architecture.

## Network Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CAN Bus Network                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚   Broker     â”‚  â€¢ Assigns client IDs (0x10-0xFE)         â”‚
â”‚  â”‚   Node       â”‚  â€¢ Manages subscriptions                  â”‚
â”‚  â”‚  (ID 0x00)   â”‚  â€¢ Routes messages                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Handles direct messages                â”‚
â”‚         â”‚                                                   â”‚
â”‚    â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚         â”‚           CAN Bus                                 â”‚
â”‚    â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚         â”‚                                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚         â”‚            â”‚            â”‚          â”‚         â”‚
â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”       â”‚
â”‚ â”‚Clientâ”‚ â”‚Clientâ”‚   â”‚ Client â”‚  â”‚ Client â”‚ â”‚ Client â”‚       â”‚
â”‚ â”‚ 0x10 â”‚ â”‚ 0x11 â”‚   â”‚  0x12  â”‚  â”‚  0x13  â”‚ â”‚  0x14  â”‚       â”‚
â”‚ â”‚Sensorâ”‚ â”‚Light â”‚   â”‚Display â”‚  â”‚Control â”‚ â”‚ Logger â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                             â”‚
â”‚  Each client can:                                           â”‚
â”‚  â€¢ Subscribe to multiple topics                             â”‚
â”‚  â€¢ Publish to any topic                                     â”‚
â”‚  â€¢ Send direct messages to broker                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Connection Sequence

### Basic Connection (No Serial Number)

```
Client                          Broker
  â”‚                               â”‚
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€ID_REQUEST (0xFF)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                               â”‚
  â”‚                               â”‚ Assign unique ID
  â”‚                               â”‚ (0x10, 0x11, ...)
  â”‚                               â”‚
  â”‚â—€â”€â”€â”€ID_RESPONSE (0xFE)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    [assigned_id]              â”‚
  â”‚                               â”‚
  â”‚  âœ“ Connected                  â”‚
  â”‚  âœ“ Ready to subscribe         â”‚
  â”‚                               â”‚
```

### Persistent ID Connection âš¡ (With Serial Number)

```
Client                          Broker                Flash Memory
  â”‚                               â”‚                        â”‚
  â”‚â”€â”€â”€â”€ID_REQUEST (0xFF)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
  â”‚    "ESP32_ABC123"             â”‚                        â”‚
  â”‚                               â”‚                        â”‚
  â”‚                               â”‚â”€â”€â”€Check if existsâ”€â”€â”€â”€â”€â–¶â”‚
  â”‚                               â”‚                        â”‚
  â”‚                               â”‚â—€â”€â”€Found: 0x10â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                               â”‚   (or assign new)      â”‚
  â”‚â—€â”€â”€â”€ID_RESPONSE (0xFE)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
  â”‚    [0x10]                     â”‚                        â”‚
  â”‚                               â”‚                        â”‚
  â”‚  âœ“ Connected with ID 0x10     â”‚                        â”‚
  â”‚  âœ“ Same ID every time! ğŸ¯     â”‚                        â”‚
  â”‚                               â”‚                        â”‚
  â”‚  [Power cycle / Reset]        â”‚                        â”‚
  â”‚                               â”‚                        â”‚
  â”‚â”€â”€â”€â”€ID_REQUEST (0xFF)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
  â”‚    "ESP32_ABC123"             â”‚                        â”‚
  â”‚                               â”‚â”€â”€â”€Check if existsâ”€â”€â”€â”€â”€â–¶â”‚
  â”‚                               â”‚â—€â”€â”€Found: 0x10â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚â—€â”€â”€â”€ID_RESPONSE (0xFE)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
  â”‚    [0x10]                     â”‚                        â”‚
  â”‚                               â”‚                        â”‚
  â”‚  âœ“ Same ID again! ğŸ¯          â”‚                        â”‚
```

## Subscription Flow

```
Client                          Broker
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€SUBSCRIBE (0x01)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    [client_id]                â”‚
  â”‚    [topic_hash_h]             â”‚
  â”‚    [topic_hash_l]             â”‚
  â”‚                               â”‚
  â”‚                               â”‚ Store subscription:
  â”‚                               â”‚ Topic 0xABCD â†’ [0x10, ...]
  â”‚                               â”‚
  â”‚  âœ“ Subscribed                 â”‚
  â”‚                               â”‚
```

## Publish-Subscribe Flow

```
Publisher (0x10)         Broker                 Subscriber (0x11)
     â”‚                     â”‚                          â”‚
     â”‚                     â”‚                          â”‚
     â”‚â”€â”€PUBLISH (0x03)â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
     â”‚  [0x10]             â”‚                          â”‚
     â”‚  [topic_hash]       â”‚                          â”‚
     â”‚  [message]          â”‚                          â”‚
     â”‚                     â”‚                          â”‚
     â”‚                     â”‚ Find subscribers         â”‚
     â”‚                     â”‚ for topic hash           â”‚
     â”‚                     â”‚                          â”‚
     â”‚                     â”‚â”€â”€TOPIC_DATA (0x04)â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                     â”‚  [0x11]                  â”‚
     â”‚                     â”‚  [topic_hash]            â”‚
     â”‚                     â”‚  [message]               â”‚
     â”‚                     â”‚                          â”‚
     â”‚                     â”‚                          â”‚
     â”‚                     â”‚  (Repeat for each        â”‚
     â”‚                     â”‚   subscriber)            â”‚
```

## Direct Messaging Flow

```
Client                          Broker
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€DIRECT_MSG (0x05)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    [client_id]                â”‚
  â”‚    [message_data]             â”‚
  â”‚                               â”‚
  â”‚                               â”‚ Process message
  â”‚                               â”‚
  â”‚â—€â”€â”€â”€ACK (0x08)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    [broker_id]                â”‚
  â”‚    [client_id]                â”‚
  â”‚    "ACK"                      â”‚
  â”‚                               â”‚
```

## Ping-Pong Flow

```
Client                          Broker
  â”‚                               â”‚
  â”‚â”€â”€â”€â”€PING (0x06)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚    [client_id]                â”‚
  â”‚                               â”‚
  â”‚                               â”‚
  â”‚â—€â”€â”€â”€PONG (0x07)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    [broker_id]                â”‚
  â”‚    [client_id]                â”‚
  â”‚                               â”‚
  â”‚  Connection verified          â”‚
  â”‚                               â”‚
```

## Message Format

### Standard Message Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CAN Frame (11-bit ID)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID Field: Message Type (0x01-0xFF)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data[0]:   First payload byte           â”‚
â”‚ Data[1]:   Second payload byte          â”‚
â”‚ Data[2]:   Third payload byte           â”‚
â”‚ Data[3]:   Fourth payload byte          â”‚
â”‚ Data[4]:   Fifth payload byte           â”‚
â”‚ Data[5]:   Sixth payload byte           â”‚
â”‚ Data[6]:   Seventh payload byte         â”‚
â”‚ Data[7]:   Eighth payload byte          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SUBSCRIBE Message (0x01)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAN ID: 0x01             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data[0]: Client ID       â”‚
â”‚ Data[1]: Topic Hash (H)  â”‚
â”‚ Data[2]: Topic Hash (L)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PUBLISH Message (0x03)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAN ID: 0x03               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data[0]: Publisher ID      â”‚
â”‚ Data[1]: Topic Hash (H)    â”‚
â”‚ Data[2]: Topic Hash (L)    â”‚
â”‚ Data[3-7]: Message Data    â”‚
â”‚            (up to 5 bytes) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### TOPIC_DATA Message (0x04)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAN ID: 0x04               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data[0]: Target Client ID  â”‚
â”‚ Data[1]: Topic Hash (H)    â”‚
â”‚ Data[2]: Topic Hash (L)    â”‚
â”‚ Data[3-7]: Message Data    â”‚
â”‚            (up to 5 bytes) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DIRECT_MSG Message (0x05)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAN ID: 0x05               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data[0]: Sender ID         â”‚
â”‚ Data[1-7]: Message Data    â”‚
â”‚            (up to 7 bytes) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Topic Hashing

```
Input: "sensors/temperature"
         â†“
    Hash Function:
    hash = 0
    for each char:
        hash = hash * 31 + char
         â†“
Output: 0xABCD (16-bit hash)
```

Example topic hashes:
- `"hello"` â†’ 0x5E918D9F â†’ 0x8D9F (truncated to 16-bit)
- `"sensors/temp"` â†’ 0x1234
- `"control/led"` â†’ 0x5678

## Broker Subscription Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Broker Subscription Table               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Topic Hash: 0x1234 ("sensors/temp")           â”‚
â”‚  Subscribers: [0x10, 0x11, 0x14]               â”‚
â”‚  Count: 3                                       â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚                                                 â”‚
â”‚  Topic Hash: 0x5678 ("control/led")            â”‚
â”‚  Subscribers: [0x12]                           â”‚
â”‚  Count: 1                                       â”‚
â”‚                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚                                                 â”‚
â”‚  Topic Hash: 0xABCD ("status")                 â”‚
â”‚  Subscribers: [0x10, 0x11, 0x12, 0x13, 0x14]  â”‚
â”‚  Count: 5                                       â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Diagram - Client

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ DISCONNECTEDâ”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ begin()
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CONNECTING  â”‚ â† Send ID_REQUEST
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   Wait for response
               â”‚
               â”‚ Receive ID_RESPONSE
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â–¶â”‚  CONNECTED  â”‚â—€â”€â”€â”
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚          â”‚           â”‚
    â”‚          â”‚ Can:      â”‚
    â”‚          â”‚ â€¢ subscribe()
    â”‚          â”‚ â€¢ publish()
    â”‚          â”‚ â€¢ sendDirectMessage()
    â”‚          â”‚ â€¢ ping()
    â”‚          â”‚           â”‚
    â”‚          â–¼           â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚  OPERATING  â”‚â”€â”€â”€â”˜
    â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚
    â”‚          â”‚ Connection lost
    â”‚          â–¼
    â””â”€â”€â”€â”€â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ RECONNECTINGâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Example Network Scenarios

### Scenario 1: Temperature Monitoring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sensor    â”‚â”€â”€â”€â”€â–¶â”‚  Broker  â”‚â”€â”€â”€â”€â–¶â”‚  Display   â”‚
â”‚  (0x10)    â”‚     â”‚  (0x00)  â”‚     â”‚  (0x11)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sensor publishes:  "sensors/temp" â†’ "25.5"
Display receives:  "sensors/temp" â† "25.5"
```

### Scenario 2: Multi-Sensor Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Temp    â”‚â”€â”
â”‚ (0x10)   â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”œâ”€â”€â”€â–¶â”‚  Broker  â”‚â”€â”€â”€â–¶â”‚ Dashboard  â”‚
â”‚ Humidity â”‚ â”‚    â”‚  (0x00)  â”‚    â”‚  (0x14)    â”‚
â”‚ (0x11)   â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Pressure â”‚â”€â”˜
â”‚ (0x12)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dashboard subscribes to:
â€¢ "sensors/temperature"
â€¢ "sensors/humidity"
â€¢ "sensors/pressure"
```

### Scenario 3: Control System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Control   â”‚â”€â”€â”€â”€â–¶â”‚  Broker  â”‚â”€â”€â”€â”€â–¶â”‚   Light    â”‚
â”‚  Panel     â”‚     â”‚  (0x00)  â”‚     â”‚   (0x11)   â”‚
â”‚  (0x10)    â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Heater   â”‚
                                    â”‚   (0x12)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Control publishes: "control/light" â†’ "on"
                   "control/heater" â†’ "75"
```

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Network Capacity @ 500 kbps                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Message size:    3-8 bytes (typical 5-6)     â”‚
â”‚  Frame overhead:  ~50 bits per message        â”‚
â”‚  Effective rate:  ~4000 messages/second       â”‚
â”‚  Practical rate:  ~1000 messages/second       â”‚
â”‚                   (with bus arbitration)      â”‚
â”‚                                                â”‚
â”‚  Latency:        < 1 ms (typical)             â”‚
â”‚  Max nodes:      255 (0x10-0xFF)              â”‚
â”‚  Max topics:     20 (configurable)            â”‚
â”‚  Max subs/topic: 10 (configurable)            â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Best Practices Visualization

```
âœ… DO:                          âŒ DON'T:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Short Messages  â”‚            â”‚ Long Messages   â”‚
â”‚ "25.5"          â”‚            â”‚ "Temperature is â”‚
â”‚ "ON"            â”‚            â”‚  currently at   â”‚
â”‚ "75"            â”‚            â”‚  25.5 degrees"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clear Topics    â”‚            â”‚ Vague Topics    â”‚
â”‚ sensors/temp    â”‚            â”‚ data            â”‚
â”‚ control/led     â”‚            â”‚ topic1          â”‚
â”‚ status/system   â”‚            â”‚ x               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Regular Pings   â”‚            â”‚ No Monitoring   â”‚
â”‚ Every 10s       â”‚            â”‚ Assume OK       â”‚
â”‚ Check response  â”‚            â”‚ Hope it works   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

This architecture provides:
- âœ… Scalable pub/sub messaging
- âœ… Automatic client management
- âœ… Efficient topic-based routing
- âœ… Direct communication channel
- âœ… Connection monitoring
- âœ… Easy to understand and use

Perfect for building distributed CAN bus systems!
